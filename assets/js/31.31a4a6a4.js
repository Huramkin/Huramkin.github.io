(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{304:function(s,a,e){"use strict";e.r(a);var t=e(5),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("DNSmasq是一个用于配置DNS和DHCP的轻便工具，适合小型网络，利用得当可以防污染，防劫持，消除广告，还可以搭配其他软件实现更多功能\n")]),s._v(" "),e("h2",{attrs:{id:"安装与配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装与配置"}},[s._v("#")]),s._v(" 安装与配置")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("#CentOS/Debian安装\nyum/apt-get install dnsmasq\n\n#macOS安装\nbrew install dnsmasq\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("Linux系统安装后的配置文件一般在 "),e("code",[s._v("/etc/dnsmasq.conf")]),s._v("\nmacOS需要运行"),e("code",[s._v("brew info dnsmasq")]),s._v("来查找配置文件地址")]),s._v(" "),e("h4",{attrs:{id:"配置文件部分说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置文件部分说明"}},[s._v("#")]),s._v(" 配置文件部分说明")]),s._v(" "),e("p",[e("code",[s._v("strict-order")]),s._v(" 意味着解析域名时，dnsmasq会按照"),e("code",[s._v("/etc/resolv.conf")]),s._v("文件中DNS服务器的顺序进行解析，直到解析成功为止。")]),s._v(" "),e("p",[e("code",[s._v("/etc/resolv.conf")]),s._v("是系统自带的文件。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 修改下面这个server字段，也可以添加上游DNS，而不需要修改 /etc/resolv.conf 使用no-resolv将此功能关闭\n# no-resolv 关闭上游dns\n# Add other name servers here, with domain specs if they are for\n# non-public domains.\nserver=上游DNSIP#port\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[e("code",[s._v("listen-address")]),s._v(" 表示DNS服务监听的地址。若仅本机使用，则使用"),e("code",[s._v("127.0.0.1")]),s._v("。如果想对局域网中的其他机器共同使用这个DNS服务器，还需要加上局域网中的地址"),e("code",[s._v("192.168.78.1,127.0.0.1")]),s._v(",同理，若想要建立公网DNS服务，则需要写入本机的公网IP。")]),s._v(" "),e("h2",{attrs:{id:"使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[s._v("#")]),s._v(" 使用")]),s._v(" "),e("h4",{attrs:{id:"启动服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动服务"}},[s._v("#")]),s._v(" 启动服务")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("#根据包管理器和系统的不同，使用的启动命令也不相同，以下三种是比较常用的\nsudo brew services start dnsmasq\n/etc/init.d/dnsmasq start\nservice dnsmasq start\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h4",{attrs:{id:"投入使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#投入使用"}},[s._v("#")]),s._v(" 投入使用")]),s._v(" "),e("p",[s._v("进入系统网络设置中将DNS修改为"),e("code",[s._v("127.0.0.1")])]),s._v(" "),e("h4",{attrs:{id:"测试服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测试服务"}},[s._v("#")]),s._v(" 测试服务")]),s._v(" "),e("p",[s._v("测试DNS服务，一般常用dig命令")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("dig @dns domain.com\n\n# 若显示找不到命令，可能是没有安装相关软件，下方命令供参考\n\napt-get install dnsutils\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h2",{attrs:{id:"其他"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[s._v("#")]),s._v(" 其他")]),s._v(" "),e("p",[s._v("防火墙开启53端口")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("vi /etc/sysconfig/iptables\n\n-A INPUT -p udp -m state --state NEW --dport 53 -j ACCEPT\n-A INPUT -p tcp -m state --state NEW --dport 53 -j ACCEPT\n#重启iptables使修改生效\nservice iptables restart\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("因为使用了海外DNS服务，有可能会解析到无法访问的地址,使用"),e("a",{attrs:{href:"https://github.com/felixonmars/dnsmasq-china-list",target:"_blank",rel:"noopener noreferrer"}},[s._v("dnsmasq-china-list"),e("OutboundLink")],1),s._v("可以解决这个问题")])])}),[],!1,null,null,null);a.default=n.exports}}]);