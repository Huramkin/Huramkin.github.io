(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{325:function(s,e,a){"use strict";a.r(e);var t=a(5),r=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("RouterOS是一种路由操作系统,带有配套的GUI操作软件,也可以使用命令直接操作,功能齐全,使用方便.由于功能繁多需要从最基本的连接到互联网开始做起,这里记录了使用过程中的一些基础问题")]),s._v(" "),a("h3",{attrs:{id:"dd安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dd安装"}},[s._v("#")]),s._v(" DD安装")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("wget http://download2.mikrotik.com/routeros/6.42.6/chr-6.42.6.img.zip -O chr.img.zip && \\\ngunzip -c chr.img.zip > chr.img && \\\nmount -o loop,offset=33554944 chr.img /mnt && \\\nADDRESS0=`ip addr show eth0 | grep global | cut -d' ' -f 6 | head -n 1` && \\\nGATEWAY0=`ip route list | grep default | cut -d' ' -f 3` && \\\necho \"/ip address add address=$ADDRESS0 interface=[/interface ethernet find where name=ether1]\n/ip route add gateway=$GATEWAY0\n\" > /mnt/rw/autorun.scr && \\\numount /mnt && \\\necho u > /proc/sysrq-trigger && \\\ndd if=chr.img bs=1024 of=/dev/vda && \\\nreboot\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("dd操作时,目标路径可能不是 /dev/vda 而是 /dev/sda 或其他,操作前先 ls /dev 查看一下\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("wget http://download2.mikrotik.com/routeros/6.43.8/chr-6.43.8.img.zip -O chr.img.zip && \\\ngunzip -c chr.img.zip > chr.img && \\\nmount -o loop,offset=33554944 chr.img /mnt && \\\nADDRESS0=`ip addr show eth0 | grep global | cut -d' ' -f 6 | head -n 1` && \\\nGATEWAY0=`ip route list | grep default | cut -d' ' -f 3` && \\\necho \"/ip address add address=$ADDRESS0 interface=[/interface ethernet find where name=ether1]\n/ip route add gateway=$GATEWAY0\n\" > /mnt/rw/autorun.scr && \\\numount /mnt && \\\necho u > /proc/sysrq-trigger && \\\ndd if=chr.img bs=1024 of=/dev/vda && \\\nreboot\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h3",{attrs:{id:"安全加固"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安全加固"}},[s._v("#")]),s._v(" 安全加固")]),s._v(" "),a("p",[s._v("禁用不常用不安全的服务")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/ip service disable telnet,f​​tp,www,www-ssl,api,api-ssl\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("禁用邻居发现")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/ip neighbor discovery-settings set discover-interface-list=none\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"添加ip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加ip"}},[s._v("#")]),s._v(" 添加IP")]),s._v(" "),a("p",[s._v("添加网关和IP以连接互联网,dd安装时网关和IP设置的脚本应该自动写在 "),a("code",[s._v("/mnt/rw/autorun.scr")]),s._v(" 中的,但是意外常有,这里还是写一下")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("#定义接口的IP和掩码\n/ip address add address=192.168.2.233/24 interface=ether1\n#定义网关\n/ip route add gateway=192.168.2.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"端口映射"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#端口映射"}},[s._v("#")]),s._v(" 端口映射")]),s._v(" "),a("p",[s._v("将外网访问 10.5.8.200 的 80 端口的数据映射到主机 192.168.0.18")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/ip firewall nat add chain=srcnat action=masquerade\n/ip firewall nat add action=dst-nat chain=dstnat dst-address=10.5.8.200 dst-port=80 protocol=tcp to-addresses=192.168.0.18 to-ports=80\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("上面的命令映射目标是一个IP,转发到公网主机时会遇到目标主机是动态IP的情况,这时候就需要一个定时脚本来定时更新IP地址,如何定时请查看下一部分")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/ip firewall nat set 6 to-addresses=[:resolve cu.ddns.com;]\n\n#使用 set 方法设置防火墙 nat 表中的编号为 6 的规则的 to-addresses 字段的值为 [:resolve cu.ddns.com;] ,也就是解析 cu.ddns.com 地址所得到的IP,关于[:resolve <arg>;]等语法请查看参考部分\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"定时任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定时任务"}},[s._v("#")]),s._v(" 定时任务")]),s._v(" "),a("h4",{attrs:{id:"scripts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scripts"}},[s._v("#")]),s._v(" Scripts")]),s._v(" "),a("p",[s._v("在Winbox 中 System > Scripts 即可找到此功能")]),s._v(" "),a("p",[s._v("如果设置 "),a("code",[s._v("Scripts")]),s._v("的")]),s._v(" "),a("p",[a("code",[s._v("Name")]),s._v("为"),a("code",[s._v("cuddns")])]),s._v(" "),a("p",[a("code",[s._v("Source")]),s._v("为"),a("code",[s._v("/ip firewall nat set 6 to-addresses=[:resolve cu.ddns.com;]")])]),s._v(" "),a("p",[s._v("使用命令")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("system script> add name=cuddns source=/ip firewall nat set 6 to-addresses=[:resolve cu.ddns.com;]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("那么这个给端口映射的目标主机换IP的脚本就设置好了,接下来是定时")]),s._v(" "),a("h4",{attrs:{id:"schedule"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#schedule"}},[s._v("#")]),s._v(" Schedule")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('system scheduler> add interval=300 name="autoddns" on-event=cuddns\n#每300秒执行一次脚本 cuddns\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"查看资源占用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看资源占用"}},[s._v("#")]),s._v(" 查看资源占用")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/system resource print\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),a("blockquote",[a("p",[s._v("DD安装部分\nhttps://www.qedev.com/router/59061.html https://web.archive.org/web/20200422025111/https://www.qedev.com/router/59061.html\nhttps://www.kvm.la/1065.html https://web.archive.org/web/20200422031312/https://www.kvm.la/1065.html")])]),s._v(" "),a("blockquote",[a("p",[s._v("安全加固部分\nhttps://www.sklinux.com/posts/secrity/mikrotik%E8%B7%AF%E7%94%B1%E5%AE%89%E5%85%A8%E9%98%B2%E8%8C%83%E8%AE%BE%E7%BD%AE/ https://archive.vn/Xp09A")])]),s._v(" "),a("blockquote",[a("p",[s._v("端口转发部分\nhttp://www.irouteros.com/?page_id=186 推荐余松老师的 《RouterOS入门到精通》\nhttps://www.ros9.com/755.html https://web.archive.org/web/20200422033539/https://www.ros9.com/755.html https://blog.csdn.net/wyf_fantastic/article/details/80083096")])])])}),[],!1,null,null,null);e.default=r.exports}}]);